<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CCOX Dashboard</title>
    <link rel="canonical" href="https://ccox.network/dashboard.html" />
    <link rel="icon" type="image/png" href="../assets/images/CCOX.png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        background-color: #0f172a; /* Slate 900 */
        color: #f8fafc;
      }

      .glass-card {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-card:hover {
        border-color: rgba(16, 185, 129, 0.3);
        transform: translateY(-2px);
      }

      .btn-primary {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.39);
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #0f172a; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

      .hero-slide {
        display: none;
        transition: opacity 1s ease-in-out;
      }

      .hero-slide.active {
        display: flex;
        animation: fadeIn 0.8s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(1.05);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .progress-glow {
        box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
      }

      .toast {
        transform: translateY(100px);
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }
      .toast.show {
        transform: translateY(0);
      }
    </style>
  </head>
  <body class="min-h-screen">
    <!-- Toast Notification -->
    <div
      id="toast"
      class="fixed bottom-8 right-8 z-[100] bg-emerald-600 px-6 py-3 rounded-xl shadow-2xl border border-emerald-400 pointer-events-none opacity-0 transition-all duration-300 transform translate-y-10"
    >
      <p id="toast-msg" class="font-bold text-white"></p>
    </div>

    <!-- Sidebar -->
    <div
      id="sidebar"
      class="w-64 bg-gray-900 h-screen fixed left-0 top-0 z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out"
    ></div>

    <!-- Main Wrapper -->
    <div class="md:ml-64 min-h-screen flex flex-col">
      
      <!-- Header Placeholder -->
      <header id="header" class="h-16 border-b border-slate-800 sticky top-0 bg-slate-900/80 backdrop-blur-md z-30"></header>

      <!-- Main Content -->
      <main class="flex-grow p-6 lg:p-10 max-w-6xl mx-auto w-full">
        
        <!-- Page Title -->
        <div class="mb-10 fade-in">
            <h1 class="text-4xl font-bold tracking-tight">Dashboard <span class="text-emerald-500">.</span></h1>
            <p class="text-slate-400 mt-2">Overview of your mining activity and assets.</p>
        </div>

          <!-- Hero Slider -->
          <section
            id="slider"
            class="relative h-64 md:h-80 rounded-3xl overflow-hidden shadow-2xl mb-12 fade-in"
            style="animation-delay: 0.1s;"
          >
            <div
              class="hero-slide active h-full w-full bg-gradient-to-br from-indigo-900 to-slate-900 flex items-center justify-center text-center p-6"
            >
              <div>
                <h2 class="text-3xl md:text-5xl font-black mb-4">
                  Mine CCOX Daily
                </h2>
                <p class="text-slate-300 max-w-md mx-auto">
                  Start your journey in the world's most accessible mining
                  ecosystem.
                </p>
              </div>
            </div>
            <div
              class="hero-slide h-full w-full bg-gradient-to-br from-emerald-900 to-slate-900 flex items-center justify-center text-center p-6"
            >
              <div>
                <h2 class="text-3xl md:text-5xl font-black mb-4">
                  Secure Network
                </h2>
                <p class="text-slate-300 max-w-md mx-auto">
                  Every block mined adds security to the CCOX decentralized
                  ledger.
                </p>
              </div>
            </div>
            <div
              class="hero-slide h-full w-full bg-gradient-to-br from-amber-900 to-slate-900 flex items-center justify-center text-center p-6"
            >
              <div>
                <h2 class="text-3xl md:text-5xl font-black mb-4">
                  Invite & Earn
                </h2>
                <p class="text-slate-300 max-w-md mx-auto">
                  Boost your hash rate by inviting friends to the platform.
                </p>
              </div>
            </div>

            <!-- Dots -->
            <div
              class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2"
              id="slider-dots"
            ></div>
          </section>

          <!-- Quick Actions -->
          <section class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-12 fade-in" style="animation-delay: 0.2s;">
            <div
              onclick="window.location.href='wallet.html'"
              class="glass-card p-6 rounded-3xl cursor-pointer group text-center"
            >
              <div class="text-3xl mb-3 text-emerald-400 group-hover:scale-110 transition-transform"><i class="fa-brands fa-google-wallet"></i></div>
              <p class="font-bold text-sm text-white">Send CCOX</p>
            </div>
            <div
              onclick="window.location.href='mining.html'"
              class="glass-card p-6 rounded-3xl cursor-pointer group text-center"
            >
              <div class="text-3xl mb-3 text-blue-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-timeline"></i></div>
              <p class="font-bold text-sm text-white">Mining Hub</p>
            </div>
            <div
              id="kyc-card"
              onclick="window.location.href='kyc.html'"
              class="glass-card p-6 rounded-3xl cursor-pointer group text-center relative overflow-hidden"
            >
              <div class="text-3xl mb-3 text-amber-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-certificate"></i></div>
              <p class="font-bold text-sm text-white">KYC Verification</p>
              <p id="kyc-status" class="text-[10px] text-slate-500 mt-1 uppercase tracking-wider font-bold">Unverified</p>
            </div>
            <div
              onclick="window.location.href='referral.html'"
              class="glass-card p-6 rounded-3xl cursor-pointer group text-center"
            >
              <div class="text-3xl mb-3 text-purple-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-feather-pointed"></i></div>
              <p class="font-bold text-sm text-white">Invite Friends</p>
            </div>
          </section>

          <!-- Stats -->
          <section class="grid md:grid-cols-3 gap-6 mb-12 fade-in" style="animation-delay: 0.3s;">
            <div
              class="glass-card p-6 rounded-3xl relative overflow-hidden"
            >
              <div class="absolute -right-4 -top-4 w-24 h-24 bg-emerald-500/10 rounded-full blur-2xl"></div>
              <p class="text-slate-400 text-xs font-bold uppercase mb-4">
                Unlocked Wallet
              </p>
              <p class="text-4xl font-black text-white">
                <span id="wallet-balance">0.00</span>
                <span class="text-sm text-emerald-500">CCOX</span>
              </p>
              <p class="text-xs text-slate-500 mt-2">
                Active balance ready for withdrawal
              </p>
            </div>
            <div
              class="glass-card p-6 rounded-3xl relative overflow-hidden"
            >
              <div class="absolute -right-4 -top-4 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl"></div>
              <p class="text-slate-400 text-xs font-bold uppercase mb-4">
                Network Growth
              </p>
              <p class="text-4xl font-black text-white">50,492</p>
              <p class="text-xs text-blue-400 mt-2">+12% from last week</p>
            </div>
            <div
              class="glass-card p-6 rounded-3xl relative overflow-hidden"
            >
              <div class="absolute -right-4 -top-4 w-24 h-24 bg-purple-500/10 rounded-full blur-2xl"></div>
              <p class="text-slate-400 text-xs font-bold uppercase mb-4">
                Shared Impact
              </p>
              <p class="text-4xl font-black text-white">13,847</p>
              <p class="text-xs text-purple-400 mt-2">
                Platform engagement score
              </p>
            </div>
          </section>

          <!-- Mining System -->
          <section
            class="glass-card rounded-3xl p-6 md:p-10 fade-in" style="animation-delay: 0.4s;"
          >
            <div class="flex flex-col md:flex-row justify-between gap-6 mb-10">
              <div>
                <h3 class="text-2xl font-black mb-2 flex items-center gap-3">
                  Mining Streak System <i class="fa-solid fa-timeline text-emerald-500"></i>
                </h3>
                <p class="text-slate-400 max-w-md">
                  24 hours mining rewards you with
                  <span class="text-emerald-400 font-bold">2 CCOX</span>. Reach
                  50 for swap.
                </p>
              </div>
              <div class="flex gap-3">
                <button
                  id="btn-start"
                  onclick="startMining()"
                  class="btn-primary text-white font-bold py-3 px-8 rounded-2xl shadow-lg transition-all hover:scale-105 active:scale-95"
                >
                  Start Mining
                </button>
                <button
                  id="btn-claim"
                  onclick="claimReward()"
                  class="hidden bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-2xl shadow-lg animate-bounce transition-all"
                >
                  Claim 2 CCOX
                </button>
              </div>
            </div>
            <div class="grid md:grid-cols-2 gap-10">
              <div class="space-y-4">
                <div class="flex justify-between items-end">
                  <span
                    id="status-text"
                    class="text-slate-400 text-xs font-bold uppercase tracking-wider"
                    >System Idle</span
                  >
                  <span
                    id="timer-display"
                    class="text-xl font-mono font-bold text-white"
                    >00:00:00</span
                  >
                </div>
                <div
                  class="h-4 w-full bg-slate-900/50 rounded-full overflow-hidden border border-slate-700/50"
                >
                  <div
                    id="progress-bar"
                    class="h-full bg-gradient-to-r from-emerald-500 to-teal-400 progress-glow transition-all w-0"
                  ></div>
                </div>
              </div>
              <div
                class="bg-slate-900/50 p-6 rounded-2xl border border-slate-700/50 flex items-center justify-between"
              >
                <div>
                  <p class="text-slate-400 text-xs font-bold uppercase mb-1">
                    Locked Balance
                  </p>
                  <p class="text-3xl font-black text-amber-400">
                    <span id="locked-balance">0.00</span> <span class="text-sm">CCOX</span>
                  </p>
                </div>
                <div class="text-amber-400 text-3xl"><i class="fa-solid fa-lock"></i></div>
              </div>
            </div>
          </section>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="assets/js/supabase-config.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
      // Global State
      let currentUserId = null;
      let walletBalance = 0;
      let lockedBalance = 0;
      const MINING_TIME = 24 * 60 * 60 * 1000; // 24 Hours

      // UI Elements
      const timerDisplay = document.getElementById("timer-display");
      const progressBar = document.getElementById("progress-bar");
      const lockedDisplay = document.getElementById("locked-balance");
      const walletDisplay = document.getElementById("wallet-balance");
      const statusText = document.getElementById("status-text");

      // Helper Functions for User-Specific Storage
      function getStorageKey(key) {
        if (!currentUserId) return key;
        return `${currentUserId}_${key}`;
      }

      function getStoredItem(key) {
        return localStorage.getItem(getStorageKey(key));
      }

      function setStoredItem(key, value) {
        localStorage.setItem(getStorageKey(key), value);
      }

      function removeStoredItem(key) {
        localStorage.removeItem(getStorageKey(key));
      }

      // Initialize
      async function init() {
        // Get current user first
        const { data: { user } } = await window.supabase.auth.getUser();
        if (user) {
          currentUserId = user.id;
        }
        
        // Load initial balances
        walletBalance = parseFloat(getStoredItem("ccox_wallet") || "0");
        lockedBalance = parseFloat(getStoredItem("ccox_locked") || "0");

        updateUI();
        startLoops();
        setupSlider();
        updateKYCStatus();
        // Update immediately when app.js fetches balances
        window.addEventListener("ccox:balances-updated", () => {
          updateUI();
        });
      }

      function updateUI() {
        // Refresh balances from localStorage to pick up server-updated values
        walletBalance = parseFloat(
          getStoredItem("ccox_wallet") || walletBalance
        );
        lockedBalance = parseFloat(
          getStoredItem("ccox_locked") || lockedBalance
        );

        if (walletDisplay)
          walletDisplay.innerText = (
            isNaN(walletBalance) ? 0 : walletBalance
          ).toFixed(2);
        if (lockedDisplay)
          lockedDisplay.innerText = (
            isNaN(lockedBalance) ? 0 : lockedBalance
          ).toFixed(2);
      }

      async function updateKYCStatus() {
        if (!currentUserId) return;
        try {
          const { data } = await window.supabase
            .from('kyc_applications')
            .select('status')
            .eq('user_id', currentUserId)
            .order('created_at', { ascending: false })
            .limit(1)
            .maybeSingle();

          const statusEl = document.getElementById('kyc-status');
          const cardEl = document.getElementById('kyc-card');
          
          if (data && statusEl && cardEl) {
            if (data.status === 'approved') {
              statusEl.innerText = 'Verified';
              statusEl.className = 'text-[10px] text-emerald-400 mt-1 uppercase tracking-wider font-bold';
              cardEl.classList.add('border-emerald-500/50');
              cardEl.classList.remove('border-slate-700/50');
            } else if (data.status === 'pending') {
              statusEl.innerText = 'Pending';
              statusEl.className = 'text-[10px] text-amber-400 mt-1 uppercase tracking-wider font-bold';
              cardEl.classList.add('border-amber-500/50');
              cardEl.classList.remove('border-slate-700/50');
            } else if (data.status === 'rejected') {
              statusEl.innerText = 'Rejected';
              statusEl.className = 'text-[10px] text-red-400 mt-1 uppercase tracking-wider font-bold';
              cardEl.classList.add('border-red-500/50');
              cardEl.classList.remove('border-slate-700/50');
            }
          }
        } catch (e) {
          console.error("KYC Status Error:", e);
        }
      }

      function showToast(msg) {
        const toast = document.getElementById("toast");
        const toastMsg = document.getElementById("toast-msg");
        if (toast && toastMsg) {
          toastMsg.innerText = msg;
          toast.classList.remove("opacity-0", "translate-y-10");
          setTimeout(() => toast.classList.add("opacity-0", "translate-y-10"), 3000);
        }
      }

      // Mining Logic
      function startMining() {
        const endTime = Date.now() + MINING_TIME;
        setStoredItem("ccox_mining_end", endTime);
        showToast("Mining session started! See you in 24 hours.");
        updateUI();
      }

      function claimReward() {
        lockedBalance += 2;
        setStoredItem("ccox_locked", lockedBalance);
        removeStoredItem("ccox_mining_end");
        const btnClaim = document.getElementById("btn-claim");
        const btnStart = document.getElementById("btn-start");
        if (btnClaim) btnClaim.classList.add("hidden");
        if (btnStart) btnStart.classList.remove("hidden");
        showToast("+2 CCOX added to locked balance!");
        updateUI();
      }

      // Update Loops
      function startLoops() {
        setInterval(async () => {
          const now = Date.now();
          // keep balances synchronized with Supabase/app.js updates stored in localStorage
          walletBalance = parseFloat(
            getStoredItem("ccox_wallet") || walletBalance
          );
          lockedBalance = parseFloat(
            getStoredItem("ccox_locked") || lockedBalance
          );

          // Mining Check
          const miningEnd = getStoredItem("ccox_mining_end");
          const btnStart = document.getElementById("btn-start");
          const btnClaim = document.getElementById("btn-claim");

          if (miningEnd) {
            const remaining = parseInt(miningEnd) - now;
            if (remaining <= 0) {
              if (timerDisplay) timerDisplay.innerText = "00:00:00";
              if (progressBar) progressBar.style.width = "100%";
              if (statusText) statusText.innerText = "Mining Complete";
              if (btnStart) btnStart.classList.add("hidden");
              if (btnClaim) btnClaim.classList.remove("hidden");
            } else {
              if (statusText) statusText.innerText = "Mining in Progress...";
              if (btnStart) btnStart.classList.add("hidden");
              if (btnClaim) btnClaim.classList.add("hidden");

              const h = Math.floor(remaining / 3600000)
                .toString()
                .padStart(2, "0");
              const m = Math.floor((remaining % 3600000) / 60000)
                .toString()
                .padStart(2, "0");
              const s = Math.floor((remaining % 60000) / 1000)
                .toString()
                .padStart(2, "0");
              if (timerDisplay) timerDisplay.innerText = `${h}:${m}:${s}`;

              const percent = ((MINING_TIME - remaining) / MINING_TIME) * 100;
              if (progressBar) progressBar.style.width = percent + "%";
            }
          } else {
            if (statusText) statusText.innerText = "System Idle";
            if (timerDisplay) timerDisplay.innerText = "00:00:00";
            if (progressBar) progressBar.style.width = "0%";
            if (btnStart) btnStart.classList.remove("hidden");
          }
        }, 1000);
      }

      // Slider Logic
      function setupSlider() {
        const slides = document.querySelectorAll(".hero-slide");
        const dotsContainer = document.getElementById("slider-dots");
        if (!dotsContainer || slides.length === 0) return;

        let current = 0;

        slides.forEach((_, i) => {
          const dot = document.createElement("div");
          dot.className = `h-2 rounded-full transition-all duration-300 ${
            i === 0 ? "w-8 bg-white" : "w-2 bg-white/40"
          }`;
          dotsContainer.appendChild(dot);
        });

        setInterval(() => {
          slides[current].classList.remove("active");
          if (dotsContainer.children[current]) {
            dotsContainer.children[current].className =
              "h-2 w-2 bg-white/40 rounded-full transition-all";
          }

          current = (current + 1) % slides.length;

          slides[current].classList.add("active");
          if (dotsContainer.children[current]) {
            dotsContainer.children[current].className =
              "h-2 w-8 bg-white rounded-full transition-all";
          }
        }, 5000);
      }

      window.onload = init;
    </script>
  </body>
</html>
